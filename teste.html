<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Teste Pagamento PIX</title>
</head>
<body>
<h2>Teste Pagamento PIX</h2>

<button id="criar">Criar Pagamento</button>
<button id="check">Check Pagamento</button>
<button id="aguardar">Aguardar Pagamento</button>

<p>ID: <span id="pagamentoId"></span></p>
<p>Status: <span id="status"></span></p>
<p>PIX Payload: <span id="payload"></span></p>
<img id="qr" style="display:block; margin-top:10px;" />

<script>
const API_KEY = "23BBCE8145B2BFB9F407C265BD82A7498F19DD90371D53CD34743E12E9F300BE"
let pagamentoId = null

document.getElementById("criar").onclick = async () => {
  const res = await fetch("http://localhost:8000/criar-pagamento", {
    method: "POST",
    headers: { "Content-Type": "application/json", "x-api-key": API_KEY },
    body: JSON.stringify({
      total_amount: 10,
      name: "João Teste",
      document: "12345678909",
      phone: "+5511999999999",
      email: "teste@exemplo.com",
      product_name: "Produto Teste",
      description: "Descrição mínima"
    })
  })
  const data = await res.json()
  pagamentoId = data.id
  document.getElementById("pagamentoId").innerText = data.id
  document.getElementById("status").innerText = data.status
  document.getElementById("payload").innerText = data.pix_payload
  document.getElementById("qr").src = data.qr_base64
}

document.getElementById("check").onclick = async () => {
  if (!pagamentoId) return alert("Crie um pagamento primeiro")
  const res = await fetch(`http://localhost:8000/check-payment/${pagamentoId}`)
  const data = await res.json()
  document.getElementById("status").innerText = data.status
}

document.getElementById("aguardar").onclick = async () => {
  if (!pagamentoId) return alert("Crie um pagamento primeiro")
  const res = await fetch(`http://localhost:8000/aguardar-pagamento/${pagamentoId}`)
  const data = await res.json()
  document.getElementById("status").innerText = data.status
}
</script>
</body>
</html>
