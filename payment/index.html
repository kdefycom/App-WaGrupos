<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Payment</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
  background: #0a0a0a;
  color: #fff;
  padding: 0;
  margin: 0;
}
.container {
  max-width: 480px;
  margin: 0 auto;
  background: #1a1a1a;
  min-height: 100vh;
}
.header {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 20px;
  background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  border-radius: 0 0 20px 20px;
}
.header-logo {
  width: 60px;
  height: 60px;
  background: rgba(255,255,255,0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.header-info h1 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}
.header-info p {
  font-size: 12px;
  opacity: 0.9;
}
.price {
  margin-left: auto;
  font-size: 24px;
  font-weight: 800;
  color: #00ff88;
  text-shadow: 0 0 10px rgba(0,255,136,0.3);
}
.section {
  padding: 24px 20px;
  border-bottom: 1px solid #2a2a2a;
}
.section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.section-icon {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.section-icon svg {
  width: 18px;
  height: 18px;
  fill: #fff;
}
.section-title {
  font-size: 16px;
  font-weight: 700;
}
.input-group {
  margin-bottom: 16px;
}
.input-group label {
  display: block;
  font-size: 14px;
  color: #999;
  margin-bottom: 8px;
}
.input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  background: #252525;
  border-radius: 10px;
  border: 1px solid #333;
  transition: all 0.3s;
}
.input-wrapper:focus-within {
  border-color: #ff8c00;
  box-shadow: 0 0 0 2px rgba(255,140,0,0.1);
}
.input-icon {
  padding: 0 14px;
  color: #666;
}
input {
  flex: 1;
  padding: 14px 14px 14px 0;
  border: none;
  background: transparent;
  color: #fff;
  font-size: 15px;
  outline: none;
}
input::placeholder {
  color: #666;
}
.payment-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 16px;
  background: #1a1a1a;
  border: 2px solid #00ff88;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 20px;
}
.payment-button:hover {
  background: rgba(0,255,136,0.05);
}
.pix-icon {
  width: 28px;
  height: 28px;
  fill: #00ff88;
}
.payment-button span {
  font-size: 16px;
  font-weight: 600;
  color: #00ff88;
}
.payment-info {
  background: #252525;
  border-radius: 10px;
  padding: 20px;
  margin-top: 20px;
}
.info-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 16px;
}
.info-item:last-child {
  margin-bottom: 0;
}
.info-icon {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
}
.info-text h4 {
  font-size: 15px;
  color: #4d9fff;
  margin-bottom: 4px;
}
.info-text p {
  font-size: 13px;
  color: #999;
  line-height: 1.4;
}
.totals {
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid #333;
}
.total-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  font-size: 15px;
}
.total-row.main {
  font-size: 18px;
  font-weight: 700;
  color: #fff;
}
.btn-primary {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #00c853 0%, #00e676 100%);
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 24px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,229,118,0.3);
}
.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}
.footer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  padding: 20px;
  font-size: 12px;
  color: #666;
}
.footer-item {
  display: flex;
  align-items: center;
  gap: 6px;
}
.qr-section {
  padding: 24px 20px;
  text-align: center;
  display: none;
}
.qr-section h3 {
  font-size: 18px;
  margin-bottom: 16px;
}
.qr-code-box {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  display: inline-block;
  margin: 20px 0;
}
#pix-payload {
  background: #252525;
  padding: 16px;
  border-radius: 8px;
  word-break: break-all;
  margin: 16px 0;
  color: #00ff88;
  font-family: monospace;
  font-size: 12px;
  max-height: 100px;
  overflow-y: auto;
}
.copy-btn {
  background: linear-gradient(135deg, #6a00ff 0%, #8b00ff 100%);
  padding: 14px 24px;
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}
.copy-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(106,0,255,0.3);
}
.timer {
  color: #ff4444;
  margin-top: 16px;
  font-weight: 600;
  font-size: 16px;
}
.success {
  color: #00ff88;
  font-weight: 700;
  margin-top: 16px;
  font-size: 18px;
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="header-logo">
      <svg viewBox="0 0 24 24" style="width:36px;height:36px;fill:#fff">
        <path d="M12 2C10.89 2 10 2.89 10 4V6H9C7.89 6 7 6.89 7 8V10C7 11.11 7.89 12 9 12H15C16.11 12 17 11.11 17 10V8C17 6.89 16.11 6 15 6H14V4C14 2.89 13.11 2 12 2M12 4C12 4 12 6 12 6C12 6 12 4 12 4M9 8H15V10H9V8M12 13C9.33 13 7.14 14.92 6.35 17.5C6.13 18.17 6 18.88 6 19.6C6 20.37 6.13 21.11 6.35 21.78C7.14 24.36 9.33 26.28 12 26.28C14.67 26.28 16.86 24.36 17.65 21.78C17.87 21.11 18 20.37 18 19.6C18 18.88 17.87 18.17 17.65 17.5C16.86 14.92 14.67 13 12 13Z"/>
      </svg>
    </div>
    <div class="header-info">
      <h1>VIP</h1>
      <p>No Pix:</p>
    </div>
    <div class="price">R$ 78,00</div>
  </div>

  <div class="section">
    <div class="section-header">
      <div class="section-icon">
        <svg viewBox="0 0 24 24">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
      <h2 class="section-title">Identifica√ß√£o</h2>
    </div>
    
    <div class="input-group">
      <label>Nome completo</label>
      <div class="input-wrapper">
        <span class="input-icon">üë§</span>
        <input type="text" id="nome" placeholder="Digite seu nome completo">
      </div>
    </div>

    <div class="input-group">
      <label>E-mail</label>
      <div class="input-wrapper">
        <span class="input-icon">‚úâÔ∏è</span>
        <input type="email" id="email" placeholder="seu@email.com">
      </div>
    </div>

    <div class="input-group">
      <label>CPF/CNPJ</label>
      <div class="input-wrapper">
        <span class="input-icon">üîñ</span>
        <input type="text" id="cpf" placeholder="Digite seu CPF ou CNPJ">
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <div class="section-icon">
        <svg viewBox="0 0 24 24">
          <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
        </svg>
      </div>
      <h2 class="section-title">Pagamento</h2>
    </div>

    <div class="payment-button">
      <svg class="pix-icon" viewBox="0 0 24 24">
        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M14.5,8L18.5,12L14.5,16H11.5L15.5,12L11.5,8H14.5M9.5,8L5.5,12L9.5,16H12.5L8.5,12L12.5,8H9.5Z"/>
      </svg>
      <span>Pix</span>
      <span style="margin-left:auto;font-size:20px;">‚úì</span>
    </div>

    <div class="payment-info">
      <div class="info-item">
        <svg class="info-icon" viewBox="0 0 24 24" style="fill:#4d9fff">
          <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
        </svg>
        <div class="info-text">
          <h4>Imediato</h4>
          <p>Ao selecionar a op√ß√£o Gerar Pix o c√≥digo para pagamento estar√° dispon√≠vel.</p>
        </div>
      </div>

      <div class="info-item">
        <svg class="info-icon" viewBox="0 0 24 24" style="fill:#4d9fff">
          <path d="M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z"/>
        </svg>
        <div class="info-text">
          <h4>Pagamento Simples</h4>
          <p>Para pagar basta abrir o aplicativo do seu banco, procurar pelo PIX e escanear o QRcode.</p>
        </div>
      </div>

      <div class="info-item">
        <svg class="info-icon" viewBox="0 0 24 24" style="fill:#4d9fff">
          <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
        </svg>
        <div class="info-text">
          <h4>100% Seguro</h4>
          <p>O pagamento com PIX foi desenvolvido pelo Banco Central para facilitar suas compras.</p>
        </div>
      </div>
    </div>

    <div class="totals">
      <div class="total-row">
        <span>Subtotal:</span>
        <span>R$ 78,00</span>
      </div>
      <div class="total-row main">
        <span>Valor total:</span>
        <span>R$ 78,00</span>
      </div>
    </div>

    <button class="btn-primary" id="btnPagar">Finalizar Compra</button>
  </div>

  <div class="qr-section" id="qrDiv">
    <h3>Pagamento PIX</h3>
    <p style="color:#999;margin-bottom:10px">Copie o c√≥digo abaixo ou escaneie o QR Code:</p>
    <div class="qr-code-box">
      <img id="qrcode" width="220" height="220">
    </div>
    <div id="pix-payload"></div>
    <button class="copy-btn" id="copyBtn">üìã Copiar C√≥digo PIX</button>
    <p class="timer" id="timer"></p>
    <p id="status"></p>
  </div>

  <div class="footer">
    <div class="footer-item">
      <span>üîí</span>
      <span>Pagamento Seguro</span>
    </div>
    <div class="footer-item">
      <span>‚úì</span>
      <span>Dados 100% Protegidos</span>
    </div>
  </div>
</div>

<script>
const btn = document.getElementById('btnPagar');
const nome = document.getElementById('nome');
const cpf = document.getElementById('cpf');
const email = document.getElementById('email');
const qrDiv = document.getElementById('qrDiv');
const qr = document.getElementById('qrcode');
const payloadDiv = document.getElementById('pix-payload');
const copyBtn = document.getElementById('copyBtn');
const timerEl = document.getElementById('timer');
const statusEl = document.getElementById('status');
let pagamentoId = null;

btn.onclick = async () => {
  if (!nome.value || !cpf.value || !email.value) {
    alert('‚ö†Ô∏è Preencha todos os campos.');
    return;
  }
  
  btn.disabled = true;
  btn.textContent = 'Gerando pagamento...';
  
  try {
    const r = await fetch('http://localhost:3000/sunize/gerar_pagamento', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': 'f2c286b2a259ee0e0051883f63b85aae6ba5b8bb0e526fcb58834e92975bac54'
      },
      body: JSON.stringify({
        usuario_id: cpf.value,
        nome: nome.value,
        email: email.value,
        valor: 78
      })
    });
    
    const j = await r.json();
    
    if (!j.success) {
      alert(j.error || 'Erro ao gerar pagamento');
      btn.disabled = false;
      btn.textContent = 'FINALIZAR COMPRA';
      return;
    }
    
    pagamentoId = j.pagamento.id;
    payloadDiv.textContent = j.pagamento.pix.payload;
    qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(j.pagamento.pix.payload)}`;
    
    qrDiv.style.display = 'block';
    document.querySelector('.section:last-of-type').style.display = 'none';
    
    let t = 300;
    const interval = setInterval(async () => {
      t--;
      const minutes = Math.floor(t / 60);
      const seconds = t % 60;
      timerEl.textContent = `‚è±Ô∏è Tempo restante: ${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      if (t <= 0) {
        clearInterval(interval);
        timerEl.textContent = '‚è±Ô∏è Tempo expirado';
        return;
      }
      
      if (t % 5 === 0) {
        const s = await fetch(`http://localhost:3000/sunize/status/${pagamentoId}`, {
          headers: {
            'x-api-key': 'f2c286b2a259ee0e0051883f63b85aae6ba5b8bb0e526fcb58834e92975bac54'
          }
        });
        const sj = await s.json();
        
        if (sj.success && sj.status === 'PAID') {
          clearInterval(interval);
          statusEl.innerHTML = '<span class="success">‚úÖ Pagamento confirmado!</span>';
          timerEl.style.display = 'none';
        }
      }
    }, 1000);
    
  } catch (error) {
    alert('Erro ao conectar com o servidor');
    btn.disabled = false;
    btn.textContent = 'FINALIZAR COMPRA';
  }
};

copyBtn.onclick = () => {
  navigator.clipboard.writeText(payloadDiv.textContent);
  copyBtn.textContent = '‚úì C√≥digo Copiado!';
  setTimeout(() => copyBtn.textContent = 'üìã Copiar C√≥digo PIX', 2000);
};
</script>
</body>
</html>
