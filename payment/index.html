<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - VIP</title>
<style>
body{font-family:Arial, sans-serif;background:#111;color:#fff;margin:0;padding:0}
.container{max-width:480px;margin:40px auto;background:#1a1a1a;border-radius:12px;overflow:hidden;box-shadow:0 0 15px rgba(0,0,0,0.5)}
.header{display:flex;align-items:center;gap:10px;padding:20px;background:#222;border-bottom:1px solid #333}
.logo svg{width:40px;height:40px;fill:#6a00ff}
.logo-text{font-size:22px;font-weight:bold;color:#6a00ff}
.price{margin-left:auto;font-size:20px;font-weight:bold;color:#00ff66}
.section{padding:20px;border-bottom:1px solid #333}
.section h3{margin:0 0 10px;color:#ffb100;font-size:16px}
input{width:100%;padding:12px;border-radius:6px;border:1px solid #444;background:#111;color:#fff;margin-top:8px;font-size:15px}
.payment-box{border:1px solid #00ff66;border-radius:6px;padding:12px;text-align:center;margin-top:10px}
.payment-box span{color:#00ff66;font-weight:bold}
.info{margin-top:10px;font-size:13px;color:#ccc;text-align:left}
.total{margin-top:20px;font-size:16px;font-weight:bold;text-align:right}
button{width:100%;padding:15px;background:#00c853;color:#fff;font-size:18px;border:none;border-radius:8px;cursor:pointer;margin-top:20px}
button:hover{background:#00a844}
.footer{text-align:center;padding:15px;font-size:12px;color:#888}
.qr-section{text-align:center;padding:20px;display:none}
#pix-payload{background:#000;padding:10px;border-radius:6px;word-break:break-all;margin-top:10px;color:#0f0}
.copy-btn{background:#6a00ff;padding:10px 15px;border:none;border-radius:6px;color:#fff;margin-top:10px;cursor:pointer}
.copy-btn:hover{background:#5800d1}
.timer{color:red;margin-top:10px;font-weight:bold}
.success{color:#00ff66;font-weight:bold;margin-top:10px}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="logo">
<svg viewBox="0 0 24 24"><path d="M12 2l2.39 7.26h7.61l-6.16 4.48 2.39 7.26L12 16.52l-6.23 4.48 2.39-7.26L2 9.26h7.61z"/></svg>
</div>
<div class="logo-text">VIP</div>
<div class="price">R$ 78,00</div>
</div>

<div class="section">
<h3>IdentificaÃ§Ã£o</h3>
<input type="text" id="nome" placeholder="Digite seu nome completo">
<input type="text" id="cpf" placeholder="Digite seu CPF">
<input type="text" id="telefone" placeholder="Digite seu telefone">
</div>

<div class="section">
<h3>Pagamento</h3>
<div class="payment-box">ðŸ’  <span>Pix</span></div>
<div class="info">
<p>âš¡ <b>Imediato</b>: Gere o cÃ³digo e pague na hora.</p>
<p>ðŸ”’ <b>100% Seguro</b>: PIX oficial do Banco Central.</p>
</div>
<div class="total">Total: R$ 78,00</div>
<button id="btnPagar">Finalizar Compra</button>
</div>

<div class="qr-section" id="qrDiv">
<h3>Pagamento PIX</h3>
<p>Copie o cÃ³digo abaixo ou escaneie o QR Code:</p>
<img id="qrcode" width="220" height="220" style="margin-top:10px">
<div id="pix-payload"></div>
<button class="copy-btn" id="copyBtn">Copiar CÃ³digo PIX</button>
<p class="timer" id="timer"></p>
<p id="status"></p>
</div>

<div class="footer">
ðŸ”’ Pagamento Seguro &nbsp; | &nbsp; ðŸ’¾ Dados 100% Protegidos
</div>
</div>

<script>
const btn=document.getElementById('btnPagar')
const nome=document.getElementById('nome')
const cpf=document.getElementById('cpf')
const tel=document.getElementById('telefone')
const qrDiv=document.getElementById('qrDiv')
const qr=document.getElementById('qrcode')
const payloadDiv=document.getElementById('pix-payload')
const copyBtn=document.getElementById('copyBtn')
const timerEl=document.getElementById('timer')
const statusEl=document.getElementById('status')
let pagamentoId=null
btn.onclick=async()=>{
if(!nome.value||!cpf.value||!tel.value)return alert('Preencha todos os campos.')
btn.disabled=true;btn.textContent='Gerando pagamento...'
const r=await fetch('http://localhost:3000/sunize/gerar_pagamento',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':'f2c286b2a259ee0e0051883f63b85aae6ba5b8bb0e526fcb58834e92975bac54'},body:JSON.stringify({usuario_id:cpf.value,nome:nome.value,email:'pagamento@kdefy.com',valor:78})})
const j=await r.json()
if(!j.success){alert(j.error||'Erro ao gerar pagamento');btn.disabled=false;btn.textContent='Finalizar Compra';return}
pagamentoId=j.pagamento.id
payloadDiv.textContent=j.pagamento.pix.payload
qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(j.pagamento.pix.payload)}`
qrDiv.style.display='block'
btn.style.display='none'
let t=300
const interval=setInterval(async()=>{
t--;timerEl.textContent=`Tempo restante: ${t}s`
if(t<=0){clearInterval(interval);timerEl.textContent='Tempo expirado';return}
if(t%5===0){
const s=await fetch(`http://localhost:3000/sunize/status/${pagamentoId}`,{headers:{'x-api-key':'f2c286b2a259ee0e0051883f63b85aae6ba5b8bb0e526fcb58834e92975bac54'}})
const sj=await s.json()
if(sj.success&&sj.status==='PAID'){clearInterval(interval);statusEl.innerHTML='<span class="success">âœ… Pagamento confirmado!</span>'}
}
},1000)
}
copyBtn.onclick=()=>{navigator.clipboard.writeText(payloadDiv.textContent);copyBtn.textContent='CÃ³digo Copiado!';setTimeout(()=>copyBtn.textContent='Copiar CÃ³digo PIX',2000)}
</script>
</body>
</html>
